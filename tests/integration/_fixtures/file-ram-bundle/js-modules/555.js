__d((function(g,r,_i,a,m,_e,d){Object.defineProperty(_e,'__esModule',{value:!0});var e=['aggregate','bulkWrite','countDocuments','createIndex','createIndexes','deleteMany','deleteOne','distinct','drop','dropIndex','dropIndexes','estimatedDocumentCount','find','findOne','findOneAndDelete','findOneAndReplace','findOneAndUpdate','indexes','indexExists','indexInformation','initializeOrderedBulkOp','insertMany','insertOne','isCapped','mapReduce','options','parallelCollectionScan','rename','replaceOne','stats','updateMany','updateOne'],n={bulkWrite:['operations'],countDocuments:['query'],createIndex:['fieldOrSpec'],createIndexes:['indexSpecs'],deleteMany:['filter'],deleteOne:['filter'],distinct:['key','query'],dropIndex:['indexName'],find:['query'],findOne:['query'],findOneAndDelete:['filter'],findOneAndReplace:['filter','replacement'],findOneAndUpdate:['filter','update'],indexExists:['indexes'],insertMany:['docs'],insertOne:['doc'],mapReduce:['map','reduce'],rename:['newName'],replaceOne:['filter','doc'],updateMany:['filter','update'],updateOne:['filter','update']};function t(e){return e&&'object'==typeof e&&e.once&&'function'==typeof e.once}var i=(function(){"use strict";function i(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(d[0])(this,i),this.name=i.id,this._operations=Array.isArray(n.operations)?n.operations:e,this._describeOperations=!('describeOperations'in n)||n.describeOperations,this._useMongoose=!!n.useMongoose}return r(d[1])(i,[{key:"loadDependency",value:function(){var e=this._useMongoose?'mongoose':'mongodb';return this._module=this._module||r(d[2]).loadModule(e)}},{key:"setupOnce",value:function(e,n){if(r(d[3]).shouldDisableAutoInstrumentation(n))('undefined'==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r(d[2]).logger.log('Mongo Integration is skipped because of instrumenter configuration.');else{var t=this.loadDependency();if(t)this._instrumentOperations(t.Collection,this._operations,n);else{var i=this._useMongoose?'mongoose':'mongodb';('undefined'==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r(d[2]).logger.error(`Mongo Integration was unable to require \`${i}\` package.`)}}}},{key:"_instrumentOperations",value:function(e,n,t){var i=this;n.forEach((function(n){return i._patchOperation(e,n,t)}))}},{key:"_patchOperation",value:function(e,n,i){if(n in e.prototype){var o=this._getSpanContextFromOperationArguments.bind(this);r(d[2]).fill(e.prototype,n,(function(e){return function(){for(var s=this,c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];var p=u[u.length-1],f=i().getScope(),_=r(d[4])._optionalChain([f,'optionalAccess',function(e){return e.getSpan},'call',function(e){return e()}]);if('function'!=typeof p||'mapReduce'===n&&2===u.length){var h=r(d[4])._optionalChain([_,'optionalAccess',function(e){return e.startChild},'call',function(e){return e(o(s,n,u))}]),y=e.call.apply(e,[this].concat(u));if(r(d[2]).isThenable(y))return y.then((function(e){return r(d[4])._optionalChain([h,'optionalAccess',function(e){return e.finish},'call',function(e){return e()}]),e}));if(t(y)){var O=y;try{O.once('close',(function(){r(d[4])._optionalChain([h,'optionalAccess',function(e){return e.finish},'call',function(e){return e()}])}))}catch(e){r(d[4])._optionalChain([h,'optionalAccess',function(e){return e.finish},'call',function(e){return e()}])}return O}return r(d[4])._optionalChain([h,'optionalAccess',function(e){return e.finish},'call',function(e){return e()}]),y}var b=r(d[4])._optionalChain([_,'optionalAccess',function(e){return e.startChild},'call',function(e){return e(o(s,n,u.slice(0,-1)))}]);return e.call.apply(e,[this].concat(r(d[5])(u.slice(0,-1)),[function(e,n){r(d[4])._optionalChain([b,'optionalAccess',function(e){return e.finish},'call',function(e){return e()}]),p(e,n)}]))}}))}}},{key:"_getSpanContextFromOperationArguments",value:function(e,t,i){var o={'db.system':'mongodb','db.name':e.dbName,'db.operation':t,'db.mongodb.collection':e.collectionName},s={op:'db',description:t,data:o},c=n[t],u=Array.isArray(this._describeOperations)?this._describeOperations.includes(t):this._describeOperations;if(!c||!u)return s;try{if('mapReduce'===t){var l=r(d[6])(i,2),p=l[0],f=l[1];o[c[0]]='string'==typeof p?p:p.name||'<anonymous>',o[c[1]]='string'==typeof f?f:f.name||'<anonymous>'}else for(var _=0;_<c.length;_++)o[`db.mongodb.${c[_]}`]=JSON.stringify(i[_])}catch(e){}return s}}],[{key:"__initStatic",value:function(){this.id='Mongo'}}]),i})();i.__initStatic(),_e.Mongo=i}),555,[451,452,426,538,539,429,439]);