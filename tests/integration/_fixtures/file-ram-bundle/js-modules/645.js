__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.MAX_PROFILE_DURATION_MS=e.HermesProfiling=void 0;var o=r(d[0])(r(d[1])),n=r(d[0])(r(d[2]));e.MAX_PROFILE_DURATION_MS=3e4;var t=(function(){function t(){var n=this;(0,o.default)(this,t),this.name=t.id,this._shouldStartProfiling=function(o){if(!o.sampled)return r(d[3]).logger.log('[Profiling] Transaction is not sampled, skipping profiling'),!1;var t=n._getCurrentHub&&n._getCurrentHub().getClient(),l=t&&t.getOptions(),f=l&&l._experiments&&'number'==typeof l._experiments.profilesSampleRate?l._experiments.profilesSampleRate:void 0;return void 0===f?(r(d[3]).logger.log('[Profiling] Profiling disabled, enable it by setting `profilesSampleRate` option to SDK init call.'),!1):!(Math.random()>f)||(r(d[3]).logger.log('[Profiling] Skip profiling transaction due to sampling.'),!1)},this._startNewProfile=function(o){var t=(0,r(d[4]).startProfiling)();t&&(n._currentProfile={profile_id:(0,r(d[3]).uuid4)(),startTimestampNs:t},o.setContext('profile',{profile_id:n._currentProfile.profile_id}),o.setMetadata({profile_id:n._currentProfile.profile_id}),r(d[3]).logger.log('[Profiling] started profiling: ',n._currentProfile.profile_id))},this._finishCurrentProfile=function(){if(n._clearCurrentProfileTimeout(),void 0!==n._currentProfile){var o=(0,r(d[4]).stopProfiling)();if(!o)return r(d[3]).logger.warn('[Profiling] Stop failed. Cleaning up...'),void(n._currentProfile=void 0);o.profile_id=n._currentProfile.profile_id,r(d[5]).PROFILE_QUEUE.add(o.profile_id,o),r(d[3]).logger.log('[Profiling] finished profiling: ',n._currentProfile.profile_id),n._currentProfile=void 0}},this._createProfileEventFor=function(o){var n,t,l,f=null===(t=null===(n=null==o?void 0:o.contexts)||void 0===n?void 0:n.profile)||void 0===t?void 0:t.profile_id;if('string'!=typeof f)return r(d[3]).logger.log('[Profiling] cannot find profile for a transaction without a profile context'),null;(null===(l=null==o?void 0:o.contexts)||void 0===l?void 0:l['.profile'])&&delete o.contexts.profile;var u=r(d[5]).PROFILE_QUEUE.get(f);if(r(d[5]).PROFILE_QUEUE.delete(f),!u)return r(d[3]).logger.log(`[Profiling] cannot find profile ${f} for transaction ${o.event_id}`),null;var s=(0,r(d[6]).createProfilingEvent)(u,o);return r(d[3]).logger.log(`[Profiling] Created profile ${f} for transaction ${o.event_id}`),s},this._clearCurrentProfileTimeout=function(){void 0!==n._currentProfileTimeout&&clearTimeout(n._currentProfileTimeout),n._currentProfileTimeout=void 0}}return(0,n.default)(t,[{key:"setupOnce",value:function(o,n){var t=this;if((0,r(d[7]).isHermesEnabled)()){this._getCurrentHub=n;var l=n().getClient();l&&'function'==typeof l.on&&(l.on('startTransaction',(function(o){t._finishCurrentProfile(),t._shouldStartProfiling(o)&&(t._currentProfileTimeout=setTimeout(t._finishCurrentProfile,3e4),t._startNewProfile(o))})),l.on('finishTransaction',(function(){t._finishCurrentProfile()})),l.on('beforeEnvelope',(function(o){if(r(d[5]).PROFILE_QUEUE.size()){var n=(0,r(d[6]).findProfiledTransactionsFromEnvelope)(o);if(n.length){var l=[];for(var f of n){var u=t._createProfileEventFor(f);u&&l.push(u)}(0,r(d[6]).addProfilesToEnvelope)(o,l)}else r(d[3]).logger.log('[Profiling] no profiled transactions found in envelope')}})))}else r(d[3]).logger.log('[Profiling] Hermes is not enabled, not adding profiling integration.')}}]),t})();e.HermesProfiling=t,t.id='HermesProfiling'}),645,[598,451,452,426,646,662,663,604]);